## 서비스 기반 아키텍처 스타일

- 마이크로서비스 아키텍처 스타일의 일종으로, 아키텍처가 유연해서 가장 실용적인 아키텍처 스타일 중 하나이다.
- 마이크로서비스나 이벤트 기반 아키텍처와 마찬가지로 분산 아키텍처지만 비교적 덜 복잡하고 비용이 많이 들지 않아서 많은 비즈니스 관련 애플리케이션에 널리 채택된 아키텍처이다.

### 13.1 토폴로지

- 각각 따로 배포된 유저 인터페이스와 원격 서비스, 그리고 모놀리스 데이터베이스로 이루어진 대규모 분산 레이어 구조이다.
- 서비스 기반 아키텍처의 도메인 서비스는 각각 단일 인스턴스로 배포하지만, 확장성, 내고장성, 처리량 요구사황에 따라 인스턴스를 여럿 둘수도 있다.
- 서비스 인스턴스를 다수 생성하여 배포하려면 유저 인터페이스로 유입된 요청이 가용한 서비스 인스턴스로 흘러갈 수 있도록 유저 인터페이스와 도메인 서비스 간의 부하 분산 기능이 필요하다.
- 프로토콜은 일반적으로 REST를 많이 쓰지만, 메시징, RPC, SOAP도 사용 가능하다.
- 유저 인터페이스는 프록시나 게이트웨이로 구성된 API 레이어를 통해 서비스에 접속할 수 있지만, 대개는 서비스 로케이터 패턴에 따라 유저 인터페이스,API 게이트웨이, 프록시에 내장된 유저 인터페이스를 직접 엑세스합니다.
- 중앙 공유 데이터베이스를 사용한다는 특징이 중요하다. 따라서 모놀리식 레이어드 아키텍처와 마찬가지로 조인 기능을 사용하면 된다.

### 13.2 토폴로지 변형

- 유연성 때문에 다양한 변형이 존재한다. 또 단일 모놀리식 데이터베이스 역시 개별 데이터베이스로 분리 할 수 있고 각 도메인 서비스 전용 데이터베이스들로 쪼갤 수도 있다.
  - 각 데이터베이스에 있는 도메인 데이터를 다른 도메인의 서비스가 필요로 하지 않도록 설계하는것이 포인트
  - 그렇게 해야 도메인 서비스 간 상호 통신을 방지하고(서비스 기반 아키텍처에서는 반드시 삼가) 데이터베이스 간의 중복 데이터를 방지할 수 있다.

### 13.3 서비스 설계 및 세분도

- 서비스 기반 아키텍처의 도메인 서비스는 단위가 크기때문에 레이어드 아키텍처 스타일로 설계하는것이 일반적
- 유저 인터페이스에서 비즈니스 기능을 호출하기 위해 퍼사드 계층을 만들어서 사용, 비즈니스 요청을 조정,조율한다.
- 서비스 기반 아키텍처의 ACID 트랜잭션 레벨의 데이터 무경성은 지원하지 않는다.
- 단위가 커서 데이터 무경성과 일관성 측면에서 유리하지만, 기능 변경시 전체 서비스를 테스트해야 하는 점과 코드가 배포 될수록 문제를 일으킬 소지가 커지는 단점이 있따.

### 13.4 데이터베이스 분할

- 주어진 애플리케이션 콘텍스트에서 서비스 수가 적은 편이라서 보통 모놀리식 데이터베이스를 공유한다.
- 데이터베이스 커플링은 테이블 스키마 변경 시 문제가 될수 있따.
- 데이터베이스 테이블 스키마를 나타낸 엔티티 객체는 전체 도메인 서비스가 함께 사용하는 커스텀 공유 라이브러리에 둔다. 이는 가장 비효율적인 구현 방법이다.
  - 테이블 구조가 변경되는 경우 단일 공유 라이브러리가 함께 변경되어야 하고 변경된 테이블의 사용여부 상관없이 전체 서비스를 변경후 재배포 해야한다.
- 데이터베이스 변경 영향도와 리스크를 낮추는 한 가지 방법은, 데이터베이스를 논리적으로 분할하고 이러한 논리 분할을 연합 공유 라이브러리를 통해 명시하는 것이다.

### 13.5 아키텍처 예시

- 민첩성, 시험성, 배포성은 물론 확장성, 내고장성, 보안 등 서비스 기반 아키텍처의 많은 장점을 실감할 수있다.
- 유연하기 떄문에 민첩성과 시험성, 배포성을 높일수 있다.

### 13.6 아키텍처 특성

- 애플리케이션을 개별 배포되는 여러 도메인 서비스로 나누면 신속한 변경이 가능하고, 도메인 범위가 한정되므로 테스트 커버리지가 향상되며, 덩치 큰 모놀리스보다 덜 위험하게, 더 자주 배포할 수 있다.
- 중복되는 기능이 많아 비용적 측면에서 효율적이지 않을수 있다.
- 서비스가 크기 떄문에 다른 분산 아키텍처에 비해 신뢰성이 우수하고 대규모 서비스는 서비스 간 네트워크 트래픽이 적고 대역폭을 덜 사용하며, 분산 트랜잭션이 많지 않기 떄문에 네트워크 신뢰성이 좋다.

### 13.7 언제 사용하는가

- 도메인 주도 설계와 궁합이 잘 맞는다.
  - 서비스를 큰 단위로 나누고 그 범위를 도메인으로 한정하기 떄문에 개별 배포된 도메인 서비스에 맞는다.
- 서비스 단위를 크게 분리하기 때문에 다른 분산 트랜잭션에 비해 더 잘 보존된다.
