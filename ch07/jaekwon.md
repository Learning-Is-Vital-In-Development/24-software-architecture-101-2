## 7장. 아키텍처 특성 범위

6.1.2절에서 여러가지 메트릭들을 보았습니다.
하지만 이는 아키텍처의 구조적 측면을 분석할 수 있는 코드 레벨의 다양한 메트릭이고, 코드에 관한 저수준의 세부사항만 밝힐뿐
아키텍처 특성에 영향을 미치는 데이터베이스 같은 외부 의존성을 지닌 컴포넌트를 평가할 수는 없습니다.

아무리 탄력적이고 성능이 좋은 코드 베이스라도, 그런 특성과 어울리지 않는 데이터베이스를 사용한다면 서비스는 성공할 수 없습니다.

이런 종류의 의존성을 측정하기 위해서 아키텍처 퀀텀 quantum 이라는 개념이 등장
이는 커네이선스라는 핵심 메트릭을 잘 이해해야함

구심/원심 커플링 같은 코드 레벨의 커플링 메트릭은 아키텍처 분석용으로는 너무 세분도가 높다
따라서 1996년 커네이선스가 등장

커네이선스: 두 컴포넌트 중 한쪽이 변경될때 다른 쪽도 변경해야 전체 시스템의 정합성이 맞다면, 이들은 커네이선스를 가지고 있는 것이다
커네이선스가 발견되는 타이밍에 이렇게 구분된다
* 정적
* 동적
    * 동기
    * 비동기

### 7.2 아키텍처 퀸텀과 세분도

아키텍처 퀸텀: 높은 기능 응집도와 동기적 커네이선스를 가진, 독립적으로 배포 가능한 아티팩트

각 문장의 의미를 자세히 살펴보면..

* 독립적으로 배포 가능
    * 다른 파트와 독립적으로 작동되는 모든 필수 컴포넌트
    * ex. 데이터베이스 없이는 동작하지 않는 애플리케이션은 데이터베이스가 퀸텀의 일부. 단일 애플리케이션 + 단일 데이터베이스라면 퀸텀 1, 마이크로서비스 + 각자 데이터베이스라면 퀸텀은 여러개
* 높은 기능 응집도
    * 컴포넌트 설계에 따라 구현된 코드가 얼마나 목적에 맞게 통합되어 있는지를 나타냄
    * 도메인 컴포넌트는 응집도가 높지만, Utility 컴포넌트는 응집도가 낮다
* 동기적 커네이선스
    * 아키텍처 퀸텀을 형성하는 애플리케이션 콘텍스트 내부 또는 분산 서비스 간의 동기 호출을 의미

아키텍처 퀀텀 개념은 아키텍처 특성의 **새로운 범위**를 제시한다
현대 시스템에서 아키텍트는 시스템 레벨보다는 퀀텀 레벨의 아키텍처 특성을 정의한다
중요한 운영 관심사에 대해 범위를 좁히고, 나눠서 생각해보면 중요한 아키텍처 문제를 조기에 할변하여 하이브리드 아키텍처도 가능할 것이다


#### 7.2.1 사례 연구: GGG

온라인 경매 시스템

* 설명
    * 이 경매 회사는 온라인 경매 시장을 전국적으로 확장하려고함
    * 고객이 참여할 경매를 선택하고, 기다렸다가 경매가 시작되면 마치 처음부터 경매인과 같은 공간에 있었던 것처럼 입찰을 시작한다
* 유저
    * 경매 당 참여자는 수백명~수천명
    * 동시에 여러개의 경매가 진행
* 요구사항
    * 경매는 가급적 실시간
    * 입찰자는 낙찰 시 자동 결제한 신용카드를 등록
    * 입찰자는 평판 지수로 추적되어야 한다
    * 입찰자는 라이브 동영상 스트림을 시청하면서 발생하는 모든 입찰을 볼 수 있어야 한다
    * 온라인/라이브 입찰 모두 입찰이 일어난 순서대로 접수되어야 한다
* 부가 콘텍스트
    * 이 경매 회사는 공격적으로 규모가 상대적으로 작은 경쟁사를 인수 합병하고 있다
    * 예산 제한은 없다. 전략적으로 그렇게 결정됨
    * 이 회사는 위조 혐의로 고발된 소송에서 이제 막 벗어났다

자 이제 여기서 아키텍처 특성을 찾아내보자


* 이 경매 회사는 온라인 경매 시장을 전국적으로 확장하려고함, 경매 당 참여자는 수백명~수천명, 동시에 여러개의 경매가 진행, 경매는 가급적 실시간
    * 유저 수를 지원하기 위해서 확장성 + 폭주하는 트래픽을 지원하는 탄력성
        * 확장성은 요구사항에 나오지만, 탄력성은 암묵적인 특성으로 나타남. 경매라는 비즈니스를 한번 생각해봐야됨
    * 실시간 -> 성능이 중요
* 입찰자는 낙찰 시 자동 결제한 신용카드를 등록, 이 회사는 위조 혐의로 고발된 소송에서 이제 막 벗어났다
    * 보안
* 입찰자는 평판 지수로 추적되어야 한다
    * 뭔가를 추적 -> 감사성, 로그성
    * 이 요구사항은 도메인일까? 아키텍처 특성일까?
        * 생각해보자..이걸 구현하려면 도메인 지식이 필요한가? 아니면 추상적인 아키텍처 특성으로 볼 수 있을까?
            * '평판 지수'라는 것은 일반적인 아키텍터 특성을 논할때 사용되는 용어는 아니다
        * 추상적인 아키텍처 특성이란 뭐냐? 우리가 폭주하는 트래픽을 처리하기 위한 탄력성을 논할때 뱅킹 서비스인지, 카탈로그 사이트인지, 비디오 스트리밍 서비스인지를 논할필요가 없다. 이게 추상적으로 얘기 가능하다는 의미
        * 아키텍트는 도메인에서 미처 다루지 못한 구조적 영향을 끼칠 만한 요구사항을 찾아봐야된다
        * 이미 요구사항이 도메인에 포함되어 있는지, 특별한 구조가 필요한건지를 잘 판단해야한다
* 이 경매 회사는 공격적으로 규모가 상대적으로 작은 경쟁사를 인수 합병하고 있다
    * 여러 회사가 서로 연계되기 위해서는 어떤 프로토콜을 쓰는게 좋을지?
* 예산 제한은 없다. 전략적으로 그렇게 결정됨
    * 예산 제한이 있다면, 예산을 맞추기 위한 여러가지 트레이드오프를 생각해볼 수 있지만, 여기선 그렇지 않다고 가정했다
* 입찰자는 라이브 동영상 스트림을 시청하면서 발생하는 모든 입찰을 볼 수 있어야 한다. 온라인/라이브 입찰 모두 입찰이 일어난 순서대로 접수되어야 한다
    * 아주 흥미로는 아키텍처 난제
    * 가용성
        * 모든 유저들의 가용성은 동일할까? 경매인이 참가하지 못한다면 아무 의미없다
    * 신뢰성
        * 총 가동 시간(uptime), 데이터 무결성, 믿을만한지를 판단하는 갖가지 운영 요소
        * 경매 사이트는 경합 조건과 메시지 순서 보장과 같은 여러 문제를 해결해야한다

아키텍트는 아키텍처 퀀텀을 배포, 커플링, 데이터를 둘 장소, 아키텍처 내부 통신 스타일을 생각하는 수단으로 활용

* 입찰자 피드백: 입찰 스트림과 입찰 동영상 스트림을 포함
    * 가용성
    * 확장성
    * 성능
* 경매인: 라이브 경매인
    * 가용성
    * 신뢰성
    * 확장성
    * 탄력성
    * 성능
    * 보안
* 입찰자: 온라인 입찰자와 입찰
    * 신뢰성
    * 가용성
    * 확장성
    * 탄력성

> 아키텍처 퀀텀이란..어떻게 보면 바운디드 컨텍스트같다. 배포, 커플링, 데이터베이스 등을 고려하여 바운디드 컨텍스트를 나누고, 그 바운디드 컨텍스트에서의 아키텍처 특성을 다시 나눠서 생각해보는거다
> 여기선 입찰자 피드백, 경매인, 입찰자라는 아키텍처 퀀텀을 선정했다
