## 10장. 레이어드 아키텍처 스타일

가장 시작하기에 좋은 아키텍처 스타일
하지만 몇몇 안티패턴이 존재

* 프레젠테이션 레이어
* 비즈니스 레이어
* 퍼시스턴스 레이어
* 데이터베이스 레이어

물리적 토폴로지 변형. 배포 단위로 나눠본다면

데이터베이스를 분리한다면 '데이터베이스 레이어'를 따로 분리 가능
데이터베이즈가 in-memory 내장되어있다면 '데이터베이스 레이어'를 같이 구성 가능

각 레이어는 특정한 역할과 임무가 있고, 다른 레이어의 역할과 임무에 대해서는 전혀 관여하지 않는다
관심사의 분리

컴포넌트를 도메인이 아닌 기술 관점으로 분리한 것이 레이어드 아키텍처 스타일
특정 도메인에 대한 수정사항이 발생하면, 도메인이 여러 레이어에 걸쳐있기 때문에 수정 범위가 커진다


각 레이어는 open or close
상위 레이어에서 하위 레이어 방향으로 요청이 이뤄지고, 건너뛸 수 없다

근데 단순 조회 로직이라면 프레젠테이션 레이어에서 바로 데이터베이스 엑세스를 하고 싶을 수 있다
이런걸 추월 차선 리더 패턴 fast-lane reader pattern 이라고 했다

레이어 격리를 지키기 위해서는 이러한 엑세스가 이뤄지면 안된다
퍼시스턴스 레이어에 변경사항이 생기면 비즈니스, 프레젠테이션 모두 영향을 받게 된다
상호 의존도가 높아지고 커플링이 생기는 것이다


어떤 레이어는 개방하는게 합리적이다
유틸리티 클래스

![image](assets/image12.png){width="800" height="400"}


* 아키텍처 싱크홀 안티패턴
    * 각 레이어가 아무일도 하지 않고 bypass 하는 패턴
    * 프레젠테이션 레이어에서 다~ 준비해버려서 중간 레이어들이 할 일이 없는 상태

80:20 법칙. 전체 요청 중 20%가 싱크홀 패턴이라면 괜찮음. 하지만 이 이상은 괜찮지 않다
한가지 방법은 전체 레이어를 그냥 개방하는 것. 하지만 이러면 커플링이 높아져 수정이 어려진다


### 장단점

* 장점
    * 작고 단순한, 빠른 시작에 적합
* 단점
    * 규모가 커질수록 유지보수성, 민첩성, 시험성, 배포성이 나빠짐
    * 배포하려면 전체 배포가 필요하고 테스트도 어려움. 다만 컴포넌트를 모킹, 스터빙은 가능
    * 모듈성이 부족
    * 병렬성?이 좋지 않다 성능 별점이 낮다

![image](assets/image13.png){width="800" height="600"}
