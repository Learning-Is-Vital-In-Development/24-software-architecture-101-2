# Chapter3. 모듈성

----
## 3.1 정의
우리는 모듈성을 이용해 객체 지향 언어의 클래스나 함수형 언어의 함수가 될 만한 서로 연관된 코드를 논리적을 묶는다.
클래스, 함수처럼 코드를 묶어놓은 덩어리가 그 예이다.
## 3.2 모듈성 측정
### 3.2.1 응집
응집은 모듈을 구성하는 파트(구성 요소)가 서로 얼마나 연관되어 있는가를 의미한다.
다음은 응집도의 측정 범위이다. ( 좋은 순 -> 나쁜 순 )
- 기능적 응집 : 모듈의 각 파타는 다른 파트와 연관되어 있고 기능상 꼭 필요한 모든 것이 모듈에 속한다.
- 순차적 응집 : 두 모듈이, 한쪽이 데이터를 출력하면 다른 한쪽이 그것을 입력 받는 형태로 상호작용한다.
- 소통적 응집 : 두 모듈이, 각자 정보에 따라 작동하거나 어떤 출력을 내는 형태로 통신 체인을 형성한다. 예를 들면 디비에 레코드를 추가하면 그 정보에 따라 이메일이 만들어지는 식.
- 절차적 응집 : 두 모듈은 정해진 순서대로 실행한다.
- 일시적 응집 : 두 모듈은 관련이 없지만 시점에 따라 함께 실행된다. 재시작 시 다같이 초기화
- 논리적 응집 : 모듈의 내부 데이터가 기능적이 아닌 논리적으로 연관되어 있다. 이를테면, 텍스트, 직렬화 객체, 스트림 데이터를 변환하는 모듈
- 동시적 응집 : 같은 소스 파일에 함께 있을 뿐..

응집도는 주관적이기 때문에 아키텍트 재량에 따라 측정도 다르다. 이러한 응집도를 조금 더 객관적으로 측정할 수 있는 LCOM이라는 메트릭을 개발했다. 
```
LCOM
공유 필드를 통해 공유되지 않는 메서드의 총 개수
LCOM 점수가 높을수록 응집 결여도가 높다. -> 응집도가 낮다.
``` 
### 3.2.2 커플링
커플링도 그래프 이론에 기반한 분석 도구들이 있다.
- 원심 커플링 : 다른 코드 아티팩트로 유출되는 접속 수
- 구심 커플링 : 코드 아티팩트로 유입되는 접속 수
### 3.2.3 추상도, 불안정도, 메인 시퀀스로부터의 거리
커플링에서 파생된 다른 메트릭들을 소개한다.
먼저 추상도는 추상 아티팩트와 구상 아티팩트의 비율, 즉 구현 대비 추상화 정도를 나타낸다.
```
추상도 = 추상 요소의 합/구상 요소의 합
```
불안정도는 원심 커플링과 (구심 커플링 + 원심 커플링)의 비율이다.
```
불안정도 = 원심 커플링 / (구심 커플링 + 원심 커플링 )
```
불안정도는 코드베이스의 변동성을 의미하며, 불안정도가 높은 코드베이스는 변경 시 커플리이 높아 깨지기 쉽다.
### 3.2.4 메인 시퀀스로부터의 거리
```
D = | A + I - 1 |
** A: 추상도, I:불안정도
```
이샂적인 그래프를 기준으로 가까울수록 클래스 균형이 잘 맞고, 오른쪽 위로 치우치거나 ( 추상화를 많이 해서 사용하기 어려운 코드),
왼쪽 아래로 치우친 부분 (추상화가 거의 없어 관리하기 힘든 코드)은 균형이 깨진거다.
### 3.2.5 커네이선스
```
두 컴포넌트 중 한쪽이 변경될 경우 다른 쪽도 변경해야 전체 시스템의 정합성이 맞는다면
이들은 커네이선스를 갖고 있는 것이다.
```
- 정적 커네이선스 : 소스 코드 레벨의 커플링이다.
  - 명칭 커네이선스 : 여러 컴포넌트의 엔티티명이 일치해야 한다.
  - 타입 커네이선스 : 엔티티 타입이 일치해야 한다.
  - 의미 커네이선스 또는 관례 커네이선스 : 여러 컴포넌트에 걸쳐 어떤 값의 의미가 일치해야 한다. int true=1;, 
  - 위치 커네이선스 : 여러 컴포넌트는 값의 순서가 일치해야 한다. 매개 변수의 순서 일치.
  - 알고리즘 커네이선스 : 알고리즘이 일치해야 한다. 인증 결과가 같아야 한다.
- 동적 커네이선스 : 런타임 호출을 분석한다.
  - 실행 컨테이넌스 : 컴포넌트의 실행 순서가 중요하다.
  - 시점 컨테이넌스 : 실행 시점이 중요하다. 동시 실행으로 경합 조건이 발생해 결과에 영향을 끼치는 사례.
  - 값 컨테이넌스 : 상호 연관된 다수의 값들을 함께 변경할 때 발생한다. 트랜잭션
  - 식별 커네이선스 : 동일한 엔티티를 참조할 때 발생. 독립적인 두 컴포넌트가 분산 큐 같은 자료 구조를 공유해서 업데이트
- 커네이선스 속성
  - 강도 : 얼마나 쉽게 리팩토링 할 수 있는가
  - 지역성 : 코드베이스의 모듈들이 서로 얼마나 가까이에 있는가. 근접한 코드는 보통 더 분리된 코드보다 높은 형태의 커네이선스를 가진다.
  - 정도 : 커네이선스가 미치는 영향의 규모. 정도가 크면 사소한 문제도 크게 영향받을 수 있다.
- 모듈성을 개선하는 3가지 방법
  - 시스템을 캡슐화한 요소들로 잘게 나누어 전체 커네이선스를 최소화한다.
  - 캡슐화 경계를 벗어나는 나머지 커네이선스를 모조리 최소화한다.
  - 캡슐화 경계 내부에서 커네이선스를 최대화한다.
- 커네이선스 규칙
  - 정도의 규칙 : 강한 형태의 커네이선스를 보다 약한 형태의 커네이선스로 전환하라
  - 지역성의 규칙 : 소프트웨어 엘리먼트 간의 거리가 멀어질수록 보다 약한 형태의 커네이선스를 사용하라.
